variables:
  job_schedule:  
    default: "0 30 0/8 ? * *"
  job_status: 
    default: "PAUSED" 

resources:
  jobs:
    dabs_demo_job_2:
      name: ${var.env}_dabs_demo_job_2

      email_notifications:
        on_duration_warning_threshold_exceeded:
          - andrea.tardif@databricks.com

      health:
        rules:
          - metric: RUN_DURATION_SECONDS
            op: GREATER_THAN
            value: 10

      tasks:
        - task_key: create-table-sql-task
          sql_task:
            file:
              path: ../src/create_tables.sql
              source: WORKSPACE
            warehouse_id: ${var.warehouse_id}
            
      parameters:
        - name: catalog
          default: ${var.catalog}
        - name: schema
          default: ${var.schema}
        - name: env
          default: ${var.env}

      schedule:
        quartz_cron_expression: ${var.job_schedule}
        timezone_id: "America/New_York"

  pipelines:
    dabs_demo_pipeline_2:
      name: ${var.env}_dabs_demo_pipeline_2
      catalog: andrea_tardif
      schema: bronze
      serverless: true
      channel: PREVIEW
      libraries:
        - notebook:
            path: ../src/dlt_pipeline.ipynb
      event_log:
        name: logs_dabs_demo
        catalog: andrea_tardif
        schema: bronze
      configuration:
        bundle.sourcePath: ${workspace.file_path}/src 

targets:
  dev:
    variables:
      job_schedule: "0 30 0/8 ? * *"
  
  test:
    variables:
      job_schedule: "0 30 0/6 ? * *"
  
  prod:
    variables:
      job_schedule: "0 30 0/4 ? * *"

      